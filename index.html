<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Agendamento | Salão de Beleza</title>
    <!-- React via CDN (sem build) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
      :root{ --bg:#0f172a; --card:#111827; --muted:#94a3b8; --text:#e5e7eb; --accent:#22c55e; --accent-2:#06b6d4; --danger:#ef4444; }
      *{ box-sizing:border-box; }
      body{ margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif; background:linear-gradient(120deg,#0b1025,#101a3a); color:var(--text); }
      .wrap{ max-width:1100px; margin:32px auto; padding:0 16px; }
      .header{ display:flex; align-items:center; justify-content:space-between; gap:16px; margin-bottom:20px; }
      .brand{ display:flex; align-items:center; gap:12px; }
      .logo{ width:42px; height:42px; border-radius:12px; background:linear-gradient(135deg,var(--accent),var(--accent-2)); display:grid; place-items:center; font-weight:800; color:#0b1025; box-shadow:0 10px 25px rgba(34,197,94,.25); }
      h1{ font-size:22px; margin:0; }
      .muted{ color:var(--muted); }
      .grid{ display:grid; grid-template-columns:1.2fr .8fr; gap:20px; }
      @media (max-width:980px){ .grid{ grid-template-columns:1fr; } }

      .card{ background:rgba(17,24,39,.6); border:1px solid rgba(148,163,184,.1); backdrop-filter: blur(8px); border-radius:18px; padding:18px; box-shadow:0 10px 35px rgba(0,0,0,.25); }
      .card h2{ margin:0 0 12px; font-size:18px; }
      label{ display:block; font-size:14px; margin:12px 0 6px; color:#cbd5e1; }
      input, select{ width:100%; padding:12px 14px; background:#0b1224; color:var(--text); border:1px solid rgba(148,163,184,.18); border-radius:12px; outline:none; transition:.2s border;
      }
      input:focus, select:focus{ border-color: var(--accent-2); }
      .row{ display:grid; grid-template-columns:1fr 1fr; gap:12px; }
      .btn{ padding:12px 16px; border:none; border-radius:12px; font-weight:700; cursor:pointer; }
      .btn-primary{ background:linear-gradient(135deg,var(--accent),var(--accent-2)); color:#04121b; }
      .btn-outline{ background:transparent; border:1px solid rgba(148,163,184,.25); color:var(--text); }
      .btn-danger{ background:transparent; border:1px solid rgba(239,68,68,.35); color:#fecaca; }
      .stack{ display:flex; flex-wrap:wrap; gap:8px; }
      .chip{ padding:6px 10px; border-radius:999px; font-size:12px; border:1px solid rgba(148,163,184,.2); color:#cbd5e1; }
      .times{ display:grid; grid-template-columns:repeat(4,1fr); gap:8px; margin-top:8px; }
      @media (max-width:600px){ .times{ grid-template-columns:repeat(2,1fr);} }
      .time{ padding:10px 12px; background:#0b1224; border:1px solid rgba(148,163,184,.18); border-radius:10px; cursor:pointer; text-align:center; color: #ffffff; }
      .time[aria-pressed="true"]{ outline:2px solid var(--accent-2); }
      .time[disabled]{ opacity:.45; cursor:not-allowed; text-decoration: line-through; }

      table{ width:100%; border-collapse:separate; border-spacing:0 10px; }
      th, td{ text-align:left; padding:10px 12px; }
      thead th{ color:#cbd5e1; font-size:13px; font-weight:600; }
      tbody tr{ background:#0b1224; border:1px solid rgba(148,163,184,.12); }
      tbody tr td:first-child{ border-top-left-radius:12px; border-bottom-left-radius:12px; }
      tbody tr td:last-child{ border-top-right-radius:12px; border-bottom-right-radius:12px; }

      .footer{ margin-top:18px; text-align:center; font-size:12px; color:var(--muted); }
      .hint{ font-size:12px; color:#9fb3c8; margin-top:6px; }
      .err{ color:#fecaca; font-size:13px; margin-top:8px; }
      .ok{ color:#bbf7d0; font-size:13px; margin-top:8px; }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel">
      const { useEffect, useMemo, useState } = React;

      const SERVICES = [
        'Corte de cabelo',
        'Escova progressiva',
        'Manicure',
        'Pedicure',
        'Coloração capilar',
        'Chapinha'
      ];

      const OPEN_HOUR = 9;   // 09:00
      const CLOSE_HOUR = 15; // 15:00 (último horário)

      function toISODate(d){
        const y = d.getFullYear();
        const m = String(d.getMonth()+1).padStart(2,'0');
        const day = String(d.getDate()).padStart(2,'0');
        return `${y}-${m}-${day}`;
      }

      function isValidSalonDate(d){
        // terça(2) a sábado(6)
        const wd = d.getDay();
        return wd >= 2 && wd <= 6;
      }

      function nextValidDate(from=new Date()){
        const d = new Date(from);
        for(let i=0;i<7;i++){
          if(isValidSalonDate(d)) return d;
          d.setDate(d.getDate()+1);
        }
        return from;
      }

      function getTimeSlots(){
        const slots = [];
        for(let h=OPEN_HOUR; h<=CLOSE_HOUR; h++){
          slots.push(`${String(h).padStart(2,'0')}:00`);
        }
        return slots;
      }

      function loadAppts(){
        try{ return JSON.parse(localStorage.getItem('appts_v1')||'[]'); }catch{ return []; }
      }
      function saveAppts(appts){ localStorage.setItem('appts_v1', JSON.stringify(appts)); }

      function useLocalAppts(){
        const [appts,setAppts] = useState(loadAppts());
        useEffect(()=>{ saveAppts(appts); },[appts]);
        const create = (a)=> setAppts(prev=>[...prev, a]);
        const remove = (id)=> setAppts(prev=>prev.filter(x=>x.id!==id));
        return { appts, create, remove };
      }

      function App(){
        const { appts, create, remove } = useLocalAppts();
        const today = new Date();
        const [date, setDate] = useState(() => toISODate(nextValidDate(today)) );
        const [service,setService] = useState(SERVICES[0]);
        const [name,setName] = useState("");
        const [phone,setPhone] = useState("");
        const [selectedTime,setSelectedTime] = useState(null);
        const [msg,setMsg] = useState(null);

        useEffect(()=>{ setMsg(null); }, [date, service, name, phone, selectedTime]);

        const timeSlots = useMemo(()=>getTimeSlots(),[]);

        const takenTimes = useMemo(()=>{
          return appts.filter(a=>a.date===date).map(a=>a.time);
        },[appts,date]);

        const dayIsClosed = useMemo(()=>{
          const d = new Date(date);
          return !isValidSalonDate(d);
        },[date]);

        function handleSubmit(e){
          e.preventDefault();
          if(dayIsClosed){ setMsg({type:'err', text:'O salão funciona de terça a sábado. Escolha uma data válida.'}); return; }
          if(!name.trim()){ setMsg({type:'err', text:'Informe seu nome.'}); return; }
          if(!selectedTime){ setMsg({type:'err', text:'Selecione um horário.'}); return; }
          if(takenTimes.includes(selectedTime)){
            setMsg({type:'err', text:'Este horário já foi reservado.'}); return;
          }
          const id = crypto.randomUUID();
          create({ id, date, time:selectedTime, service, name: name.trim(), phone: phone.trim() });
          setSelectedTime(null); setName(""); setPhone("");
          setMsg({type:'ok', text:'Agendamento confirmado!'});
        }

        function formatBR(dstr){
          const d = new Date(dstr+"T00:00:00");
          return d.toLocaleDateString('pt-BR',{ weekday:'long', day:'2-digit', month:'2-digit', year:'numeric' });
        }

        const upcoming = appts
          .slice()
          .sort((a,b)=> (a.date+a.time).localeCompare(b.date+b.time));

        return (
          <div className="wrap">
            <header className="header">
              <div className="brand">
                <div className="logo">SB</div>
                <div>
                  <h1>Agendamento do Salão</h1>
                  <div className="muted">Funcionamento: terça a sábado • 09:00–15:00</div>
                </div>
              </div>
              <div className="stack">
                {SERVICES.map(s=> <span key={s} className="chip">{s}</span>)}
              </div>
            </header>

            <div className="grid">
              <section className="card">
                <h2>Nova reserva</h2>
                <form onSubmit={handleSubmit}>
                  <div className="row">
                    <div>
                      <label>Data</label>
                      <input type="date"
                        value={date}
                        min={toISODate(new Date())}
                        onChange={e=>setDate(e.target.value)} />
                      <div className="hint">Somente terça a sábado são aceitos.</div>
                    </div>
                    <div>
                      <label>Serviço</label>
                      <select value={service} onChange={e=>setService(e.target.value)}>
                        {SERVICES.map(s=> <option key={s} value={s}>{s}</option>)}
                      </select>
                    </div>
                  </div>

                  <div style={{marginTop:12}}>
                    <label>Horários disponíveis</label>
                    <div className="times">
                      {timeSlots.map(t=>{
                        const taken = takenTimes.includes(t);
                        return (
                          <button type="button" key={t} className="time"
                            aria-pressed={selectedTime===t}
                            disabled={taken || dayIsClosed}
                            onClick={()=> setSelectedTime(t)}>
                            {t}
                          </button>
                        );
                      })}
                    </div>
                  </div>

                  <div className="row" style={{marginTop:12}}>
                    <div>
                      <label>Nome</label>
                      <input value={name} onChange={e=>setName(e.target.value)} placeholder="Seu nome" />
                    </div>
                    <div>
                      <label>Telefone (opcional)</label>
                      <input value={phone} onChange={e=>setPhone(e.target.value)} placeholder="(DDD) 9 0000-0000" />
                    </div>
                  </div>

                  {msg && <div className={msg.type==='ok'? 'ok':'err'}>{msg.text}</div>}

                  <div style={{display:'flex', gap:10, marginTop:14}}>
                    <button className="btn btn-primary" type="submit">Confirmar agendamento</button>
                    <button className="btn btn-outline" type="button" onClick={()=>{ setSelectedTime(null); setName(''); setPhone(''); setMsg(null); }}>Limpar</button>
                  </div>
                </form>
              </section>

              <section className="card">
                <h2>Agenda</h2>
                {upcoming.length === 0 ? (
                  <div className="muted">Nenhum agendamento ainda.</div>
                ) : (
                  <div style={{overflowX:'auto'}}>
                    <table>
                      <thead>
                        <tr>
                          <th>Data</th>
                          <th>Horário</th>
                          <th>Serviço</th>
                          <th>Cliente</th>
                          <th>Telefone</th>
                          <th>Ações</th>
                        </tr>
                      </thead>
                      <tbody>
                        {upcoming.map(a=> (
                          <tr key={a.id}>
                            <td>{formatBR(a.date)}</td>
                            <td>{a.time}</td>
                            <td>{a.service}</td>
                            <td>{a.name}</td>
                            <td>{a.phone || '-'}</td>
                            <td>
                              <button className="btn btn-danger" onClick={()=>remove(a.id)}>Cancelar</button>
                            </td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>
                )}
                <div className="hint">Os dados ficam salvos no seu navegador (localStorage).</div>
              </section>
            </div>

            <div className="footer">© {new Date().getFullYear()} Salão de Beleza — Demo Front-end</div>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  </body>
</html>
